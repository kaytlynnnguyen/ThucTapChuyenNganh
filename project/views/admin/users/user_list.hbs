<!-- THÔNG BÁO ALERT MẠNH -->
{{#if success_message}}
<div style="position: fixed; top: 20px; right: 20px; z-index: 9999; background: #28a745; color: white; padding: 15px; border-radius: 5px; box-shadow: 0 4px 8px rgba(0,0,0,0.3); min-width: 300px;">
    ✅ {{success_message}}
    <button onclick="this.parentElement.remove()" style="float: right; background: none; border: none; color: white; font-size: 18px; cursor: pointer; margin-left: 10px;">&times;</button>
</div>
{{/if}}
{{#if error_message}}
<div style="position: fixed; top: 20px; right: 20px; z-index: 9999; background: #dc3545; color: white; padding: 15px; border-radius: 5px; box-shadow: 0 4px 8px rgba(0,0,0,0.3); min-width: 300px;">
    ❌ {{error_message}}
    <button onclick="this.parentElement.remove()" style="float: right; background: none; border: none; color: white; font-size: 18px; cursor: pointer; margin-left: 10px;">&times;</button>
</div>
{{/if}}

<!-- Page Heading -->
<div class="row">
    <div class="col-lg-12">
        <h1 class="page-header">
            Quản lý người dùng
            <small>Danh sách tất cả người dùng</small>
        </h1>
    </div>
</div>

<!-- Add User Button -->
<div class="row mb-3">
    <div class="col-lg-12">
        <a href="/admin/users/create" class="btn btn-primary">
            <i class="fa fa-plus"></i> Thêm người dùng mới
        </a>
    </div>
</div>

<!-- Search Form -->
<div class="row mb-4">
    <div class="col-lg-12">
        <form method="GET" action="/admin/users" class="form-inline">
            <div class="form-group mr-3">
                <input type="text" name="search" class="form-control" placeholder="Tìm kiếm theo tên hoặc email..." value="{{search}}" style="width: 300px;">
            </div>
            <button type="submit" class="btn btn-primary mr-2">
                <i class="fa fa-search"></i> Tìm kiếm
            </button>
            <a href="/admin/users" class="btn btn-secondary">
                <i class="fa fa-refresh"></i> Xóa bộ lọc
            </a>
        </form>
    </div>
</div>

<!-- Statistics -->
<div class="row mb-3">
    <div class="col-lg-12">
        <div class="alert alert-info">
            <strong>Thống kê:</strong> Tổng cộng {{totalUsers}} người dùng
            {{#if search}} - Tìm kiếm: "{{search}}"{{/if}}
        </div>
    </div>
</div>

<!-- Users Table -->
<div class="row">
    <div class="col-lg-12">
        <div class="card">
            <div class="card-header">
                <i class="fa fa-users"></i> Danh sách người dùng
            </div>
            <div class="card-body">
                {{#if users}}
                <div class="table-responsive">
                    <table class="table table-striped table-hover text-center align-middle">
                        <thead class="table-dark">
                            <tr>
                                <th scope="col">STT</th>
                                <th scope="col">Tên User</th>
                                <th scope="col">Email</th>
                                <th scope="col">Trạng thái</th>
                                <th scope="col">Sửa</th>
                                <th scope="col">Xóa</th>
                            </tr>
                        </thead>
                        <tbody>
                            {{#each users}}
                            <tr>
                                <th scope="row">{{stt}}</th>
                                <td>
                                    <strong>{{name}}</strong>
                                </td>
                                <td>{{email}}</td>
                                <td>
                                    <span class="badge badge-success">Active</span>
                                </td>
                                <td>
                                    <a href="/admin/users/edit/{{_id}}" class="btn btn-sm btn-warning">
                                        <i class="fa fa-pencil"></i>
                                    </a>
                                </td>
                                <td>
                                    <form action="/admin/users/{{_id}}?_method=DELETE" method="post" style="display: inline;" onsubmit="return confirm('Bạn có chắc muốn xóa người dùng này?')">
                                        <button type="submit" class="btn btn-sm btn-danger">
                                            <i class="fa fa-trash"></i>
                                        </button>
                                    </form>
                                </td>
                            </tr>
                            {{/each}}
                        </tbody>
                    </table>
                </div>

                <!-- Pagination -->
                {{#if (gt totalPages 1)}}
                <nav aria-label="Page navigation" class="mt-4">
                    <ul class="pagination justify-content-center">
                        {{#if (gt currentPage 1)}}
                        <li class="page-item">
                            <a class="page-link" href="/admin/users?page={{math currentPage '-' 1}}{{#if search}}&search={{search}}{{/if}}">« Trước</a>
                        </li>
                        {{/if}}
                        
                        {{#if (gt currentPage 1)}}
                        <li class="page-item">
                            <a class="page-link" href="/admin/users?page={{math currentPage '-' 1}}{{#if search}}&search={{search}}{{/if}}">{{math currentPage '-' 1}}</a>
                        </li>
                        {{/if}}
                        
                        <li class="page-item active">
                            <span class="page-link">{{currentPage}}</span>
                        </li>
                        
                        {{#if (lt currentPage totalPages)}}
                        <li class="page-item">
                            <a class="page-link" href="/admin/users?page={{math currentPage '+' 1}}{{#if search}}&search={{search}}{{/if}}">{{math currentPage '+' 1}}</a>
                        </li>
                        {{/if}}
                        
                        {{#if (lt currentPage totalPages)}}
                        <li class="page-item">
                            <a class="page-link" href="/admin/users?page={{math currentPage '+' 1}}{{#if search}}&search={{search}}{{/if}}">Sau »</a>
                        </li>
                        {{/if}}
                    </ul>
                </nav>
                
                <div class="text-center mt-2">
                    <small class="text-muted">
                        Trang {{currentPage}} / {{totalPages}} - Hiển thị {{users.length}} / {{totalUsers}} người dùng
                    </small>
                </div>
                {{/if}}

                {{else}}
                <div class="alert alert-warning">
                    {{#if error}}
                    {{error}}
                    {{else}}
                    Không tìm thấy người dùng nào.
                    {{/if}}
                </div>
                {{/if}}
            </div>
        </div>
    </div>
</div>

<!-- THÔNG BÁO ALERT BẰNG JAVASCRIPT -->
<script>
// Hàm hiển thị thông báo
function showAlert(message, type = 'success') {
    const alertDiv = document.createElement('div');
    const bgColor = type === 'success' ? '#28a745' : '#dc3545';
    const icon = type === 'success' ? '✅' : '❌';
    
    alertDiv.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 9999;
        background: ${bgColor};
        color: white;
        padding: 15px 20px;
        border-radius: 5px;
        box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        min-width: 300px;
        max-width: 500px;
        font-size: 14px;
        font-family: Arial, sans-serif;
    `;
    
    alertDiv.innerHTML = `
        ${icon} ${message}
        <button onclick="this.parentElement.remove()" style="
            float: right;
            background: none;
            border: none;
            color: white;
            font-size: 18px;
            cursor: pointer;
            margin-left: 10px;
        ">&times;</button>
    `;
    
    document.body.appendChild(alertDiv);
    
    // Tự động ẩn sau 5 giây
    setTimeout(() => {
        if (alertDiv.parentElement) {
            alertDiv.remove();
        }
    }, 5000);
}

// Kiểm tra URL để hiển thị thông báo phù hợp
window.addEventListener('DOMContentLoaded', function() {
    const urlParams = new URLSearchParams(window.location.search);
    const success = urlParams.get('success');
    const error = urlParams.get('error');
    
    if (success) {
        showAlert(decodeURIComponent(success), 'success');
    }
    if (error) {
        showAlert(decodeURIComponent(error), 'error');
    }
});
</script>