<!-- Breadcrumb Begin -->
<div class="breadcrumb-option">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <div class="breadcrumb__links">
                    <a href="/"><i class="fa fa-home"></i> Home</a>
                    <span>Danh sách phim</span>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Breadcrumb End -->

<!-- Movies Section Begin -->
<section class="blog spad">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <div class="section-title">
                    <h4>Danh sách phim</h4>
                </div>
            </div>
        </div>

        <!-- Search and Filter -->
        <div class="row mb-4">
            <div class="col-lg-12">
                <form method="GET" action="/movies" class="d-flex gap-3 align-items-end flex-wrap">
                <label style="color: white;">Tìm kiếm: </label>
                    <div class="flex-grow-1" style="min-width: 300px;">
                        <input type="text" name="search" class="form-control" placeholder="Tên phim, mô tả, thể loại..." value="{{search}}">
                    </div>
                    {{#if genres}}
                    <label style="color: #f0f0f0;">Thể loại: </label>
                    <div style="width: 200px;">
                        <select name="genre" class="form-control">
                            <option value="">Tất cả</option>
                            {{#each genres}}
                            <option value="{{this}}" {{#if (eq ../genre this)}}selected{{/if}}>{{this}}</option>
                            {{/each}}
                        </select>
                    </div>
                    {{/if}}
                    <div>
                        <button type="submit" class="btn btn-primary">Tìm kiếm</button>
                        <a href="/movies" class="btn btn-secondary">Xóa bộ lọc</a>
                    </div>
                </form>
            </div>
        </div>

        <!-- Movies Grid -->
        <div class="row">
            {{#if movies}}
                {{#each movies}}
                <div class="col-lg-3 col-md-4 col-sm-6 mb-4">
                    <div class="product__item">
                        <div class="product__item__pic" style="min-height: 400px; overflow: hidden; background: #f0f0f0;">
                            <img src="{{movieImage poster imgId @index}}" 
                                 alt="{{title}}" 
                                 style="width: 100%; height: 400px; object-fit: cover; display: block;"
                                 onerror="this.src='/img/popular/popular-1.jpg'">
                        </div>
                        <div class="product__item__text">
                            <ul>
                                {{#if genres}}
                                <li>{{genres}}</li>
                                {{else}}
                                <li>Movie</li>
                                {{/if}}
                                {{#if releaseDate}}
                                <li>{{releaseDate}}</li>
                                {{/if}}
                            </ul>
                            <h5><a href="/movies/{{_id}}">{{title}}</a></h5>
                            {{#if rating}}
                            <div class="mt-1">
                                <i class="fa fa-star" style="color: gold;"></i> {{rating}}/10
                            </div>
                            {{/if}}
                            <div class="mt-2">
                                {{#if ../user}}
                                    {{#if _id}}
                                    <a href="/movies/{{_id}}/watch" class="btn btn-sm btn-primary">
                                        <i class="fa fa-play"></i> Xem Trailer
                                    </a>
                                    {{else}}
                                    <span class="btn btn-sm btn-secondary disabled">Không có trailer</span>
                                    {{/if}}
                                {{else}}
                                    <a href="/login" class="btn btn-sm btn-warning">
                                        <i class="fa fa-lock"></i> Đăng nhập để xem
                                    </a>
                                {{/if}}
                            </div>
                        </div>
                    </div>
                </div>
                {{/each}}
            {{else}}
                <div class="col-lg-12">
                    <div class="text-center" style="padding: 40px 20px;">
                        <i class="fa fa-film" style="font-size: 48px; color: #ccc; margin-bottom: 20px;"></i>
                        <h4>Không tìm thấy phim nào</h4>
                        <p class="text-muted">Vui lòng thử lại với từ khóa khác</p>
                        <a href="/movies" class="btn btn-primary">Xem tất cả phim</a>
                    </div>
                </div>
            {{/if}}
        </div>

        <!-- Pagination -->
        {{#if (gt totalPages 1)}}
        <div class="row mt-4">
            <div class="col-lg-12">
                <div class="product__pagination" style="text-align: center;">
                    {{#if (gt currentPage 1)}}
                    <a href="/movies?page={{math currentPage '-' 1}}{{#if search}}&search={{search}}{{/if}}{{#if genre}}&genre={{genre}}{{/if}}">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    {{/if}}
                    
                    {{#if (gt currentPage 1)}}
                    <a href="/movies?page={{math currentPage '-' 1}}{{#if search}}&search={{search}}{{/if}}{{#if genre}}&genre={{genre}}{{/if}}">{{math currentPage '-' 1}}</a>
                    {{/if}}
                    
                    <a href="#" class="active">{{currentPage}}</a>
                    
                    {{#if (lt currentPage totalPages)}}
                    <a href="/movies?page={{math currentPage '+' 1}}{{#if search}}&search={{search}}{{/if}}{{#if genre}}&genre={{genre}}{{/if}}">{{math currentPage '+' 1}}</a>
                    {{/if}}
                    
                    {{#if (lt currentPage totalPages)}}
                    <a href="/movies?page={{math currentPage '+' 1}}{{#if search}}&search={{search}}{{/if}}{{#if genre}}&genre={{genre}}{{/if}}">
                        <i class="fa fa-angle-right"></i>
                    </a>
                    {{/if}}
                </div>
                <p class="text-muted text-center mt-3">Hiển thị {{movies.length}} / {{totalMovies}} phim</p>
            </div>
        </div>
        {{else}}
        <div class="row mt-4">
            <div class="col-lg-12">
                <p class="text-muted text-center">Hiển thị {{movies.length}} / {{totalMovies}} phim</p>
            </div>
        </div>
        {{/if}}
    </div>
</section>
<!-- Movies Section End -->


