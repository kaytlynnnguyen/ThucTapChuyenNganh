<!-- Breadcrumb Begin -->
<div class="breadcrumb-option">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <div class="breadcrumb__links">
                    <a href="/"><i class="fa fa-home"></i> Home</a>
                    <a href="/movies">Danh sách phim</a>
                    <span>{{movie.title}}</span>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Breadcrumb End -->

<!-- Anime Section Begin -->
<section class="anime-details spad">
    <div class="container">
        <!-- Flash Messages -->
        {{#if success_message}}
        <div class="alert alert-success alert-dismissible fade show" role="alert">
            {{success_message}}
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
        {{/if}}
        {{#if error_message}}
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
            {{error_message}}
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
        {{/if}}

        <div class="anime__details__content">
            <div class="row">
                <div class="col-lg-3">
                    <div class="anime__details__pic" style="height: 500px; overflow: hidden; background: #f0f0f0; border-radius: 8px; line-height: 0;">
                        <img src="{{movieImage movie.poster movie.imgId 0}}" 
                             alt="{{movie.title}}" 
                             style="width: 100%; height: 100%; object-fit: cover; display: block; vertical-align: top;"
                             onerror="this.src='/img/popular/popular-1.jpg'">
                    </div>
                </div>
                <div class="col-lg-9">
                    <div class="anime__details__text">
                        <div class="anime__details__title">
                            <h3>{{movie.title}}</h3>
                            {{#if movie.releaseDate}}
                            <span>{{movie.releaseDate}}</span>
                            {{/if}}
                        </div>
                        <div class="anime__details__rating">
                            {{#if movie.rating}}
                            <div class="rating">
                                {{#times (math movie.rating '/' 2)}}
                                <a href="#"><i class="fa fa-star"></i></a>
                                {{/times}}
                            </div>
                            <span>{{movie.rating}} / 10</span>
                            {{else}}
                            <span>Chưa có đánh giá</span>
                            {{/if}}
                        </div>
                        {{#if movie.overview}}
                        <p style="color: white;">{{movie.overview}}</p>
                        {{else}}
                        <p>Chưa có mô tả cho bộ phim này.</p>
                        {{/if}}
                        <div class="anime__details__widget">
                            <div class="row">
                                <div class="col-lg-6 col-md-6">
                                    <ul>
                                        {{#if movie.releaseDate}}
                                        <li><span>Ngày phát hành:</span> {{movie.releaseDate}}</li>
                                        {{/if}}
                                        {{#if movie.genres}}
                                        <li><span>Thể loại:</span> {{movie.genres}}</li>
                                        {{/if}}
                                    </ul>
                                </div>
                                <div class="col-lg-6 col-md-6">
                                    <ul>
                                        {{#if movie.rating}}
                                        <li><span>Đánh giá:</span> {{movie.rating}} / 10</li>
                                        {{/if}}
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="anime__details__btn">
                            {{#if user}}
                                {{#if movie._id}}
                                <a href="/movies/{{movie._id}}/watch" class="watch-btn">
                                    <span>Xem Phim</span> 
                                    <i class="fa fa-angle-right"></i>
                                </a>
                                {{else}}
                                <span class="watch-btn disabled">Không có trailer</span>
                                {{/if}}
                            {{else}}
                                <a href="/login" class="watch-btn" style="background-color: #f39c12;">
                                    <span>Đăng nhập để xem</span> 
                                    <i class="fa fa-lock"></i>
                                </a>
                            {{/if}}
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-8 col-md-8">
                {{#if movie.overview}}
                <div class="anime__details__review">
                    <div class="section-title">
                        <h5>Mô tả phim</h5>
                    </div>
                    <p style="color: white;">{{movie.overview}}</p>
                </div>
                {{/if}}

                <!-- Comments Section -->
                <div class="anime__details__review">
                    <div class="section-title">
                        <h5>Đánh giá & Bình luận</h5>
                    </div>
                    
                    <!-- Add Comment Form -->
                    {{#if user}}
                    <div class="comment-form" style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 8px; margin-bottom: 30px;">
                        <h6 style="color: white; margin-bottom: 15px;">Viết đánh giá của bạn</h6>
                        <form action="/movies/{{movie._id}}/comment" method="POST">
                         <label style="color: white;">Đánh giá:</label>
                            <div class="row">
                               
                                <div class="col-lg-6 mb-3">
                                    <select name="rating" class="form-control" required>
                                        <option value="">Chọn số sao</option>
                                        <option value="5">⭐⭐⭐⭐⭐ (5 sao)</option>
                                        <option value="4">⭐⭐⭐⭐ (4 sao)</option>
                                        <option value="3">⭐⭐⭐ (3 sao)</option>
                                        <option value="2">⭐⭐ (2 sao)</option>
                                        <option value="1">⭐ (1 sao)</option>
                                    </select>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label style="color: white;">Bình luận:</label>
                                <textarea name="content" class="form-control" rows="4" placeholder="Chia sẻ cảm nhận của bạn về bộ phim..." required maxlength="500"></textarea>
                                <small class="text-muted">Tối đa 500 ký tự</small>
                            </div>
                            <button type="submit" class="btn btn-primary">Gửi đánh giá</button>
                        </form>
                    </div>
                    {{else}}
                    <div class="comment-form" >
                        <p style="color: white;">Bạn cần <a href="/login" style="color: #e50914;">đăng nhập</a> để viết đánh giá</p>
                    </div>
                    {{/if}}

                    <!-- Comments List -->
                    {{#if comments}}
                    <div class="comments-list">
                        {{#each comments}}
                        <div class="comment-item">
                            <div class="comment-header" >
                                <div>
                                    <strong style="color: white;">{{user.name}}</strong>
                                    <div class="rating" style="color: #ffc107;">
                                        {{#times rating}}⭐{{/times}}
                                    </div>
                                </div>
                                <small class="text-muted">{{formatDate createdAt}}</small>
                            </div>
                            <p style="color: #ccc; margin: 0;">{{content}}</p>
                        </div>
                        {{/each}}
                    </div>
                    {{else}}
                    <p style="color: #ccc;">Chưa có đánh giá nào cho bộ phim này.</p>
                    {{/if}}
                </div>
            </div>
            <div class="col-lg-4 col-md-4">
                {{#if relatedMovies}}
                <div class="anime__details__sidebar">
                    <div class="section-title">
                        <h5>Phim liên quan</h5>
                    </div>
                    {{#each relatedMovies}}
                    <div class="product__sidebar__view__item" style="margin-bottom: 20px;">
                        <div style="height: 150px; overflow: hidden; background: #f0f0f0; margin-bottom: 10px; border-radius: 5px; line-height: 0;">
                            <img src="{{movieImage poster imgId @index}}" 
                                 alt="{{title}}" 
                                 style="width: 100%; height: 100%; object-fit: cover; display: block; vertical-align: top;"
                                 onerror="this.src='/img/popular/popular-1.jpg'">
                        </div>
                        <h5 style="margin: 0; font-weight: bold;">
                            <a href="/movies/{{_id}}" style="color: #333; text-decoration: none;">{{title}}</a>
                        </h5>
                        {{#if releaseDate}}
                        <div style="color: #666; font-size: 14px; margin-top: 5px;">
                            <i class="fa fa-calendar"></i> {{releaseDate}}
                        </div>
                        {{/if}}
                    </div>
                    {{/each}}
                </div>
                {{/if}}
            </div>
        </div>
    </div>
</section>
<!-- Anime Section End -->
